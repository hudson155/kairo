name: "Docs"

permissions:
  contents: "read"
  pages: "write"
  id-token: "write"

on:
  push:
    branches:
      - "main"
    paths:
      - "docs/**"
      - "kairo-*/README.md"
      - "README.md"
  pull_request:
    paths:
      - "docs/**"
      - "**/README.md"
  workflow_dispatch:

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: "ubuntu-latest"
    steps:
      - name: "Check out"
        uses: "actions/checkout@v6"
      - name: "Set up Node.js"
        uses: "actions/setup-node@v4"
        with:
          node-version: "22"
      - name: "Cache node_modules"
        id: "cache-deps"
        uses: "actions/cache@v4"
        with:
          path: "docs/node_modules"
          key: "docs-node-modules-${{ hashFiles('docs/package-lock.json') }}"
      - name: "Install dependencies"
        if: steps.cache-deps.outputs.cache-hit != 'true'
        working-directory: "docs"
        run: npm ci
      - name: "Build docs"
        working-directory: "docs"
        run: npm run build
      - name: "Upload artifact"
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        uses: "actions/upload-pages-artifact@v3"
        with:
          path: "docs/dist"

  deploy:
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    needs: "build"
    runs-on: "ubuntu-latest"
    environment:
      name: "github-pages"
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: "Deploy to GitHub Pages"
        id: "deployment"
        uses: "actions/deploy-pages@v4"
